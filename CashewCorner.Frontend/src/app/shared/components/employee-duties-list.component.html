<div class="duties-section">
  <div class="section-header">
    <h3>Employee Duties</h3>
    <button class="primary-small" type="button" (click)="openAssignDutyModal()">
      + Assign Duty
    </button>
  </div>

  <div *ngIf="isLoading" class="info">Loading duties...</div>
  
  <div *ngIf="!isLoading && duties.length === 0" class="no-duties-message">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M9 11l3 3L22 4"></path>
      <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <p>No duties assigned yet</p>
    <small>Click "Assign Duty" to create a new task</small>
  </div>

  <div *ngIf="!isLoading && duties.length > 0" class="duties-grid">
    <div *ngFor="let duty of duties" class="duty-card" [class.status-assigned]="duty.status === 'assigned'" [class.status-in-progress]="duty.status === 'in-progress'" [class.status-completed]="duty.status === 'completed'" [class.status-cancelled]="duty.status === 'cancelled'">
      <div class="duty-header">
        <div class="duty-title">
          <h4>{{ duty.taskType }}</h4>
          <span class="status-badge" [ngClass]="'status-' + duty.status">{{ duty.status | titlecase }}</span>
        </div>
        <div class="duty-actions">
          <button type="button" class="icon-btn" title="Update status" (click)="openStatusModal(duty)">
            âš™ï¸
          </button>
          <button type="button" class="icon-btn danger" title="Delete duty" (click)="deleteDuty(duty.dutyId)">
            ğŸ—‘ï¸
          </button>
        </div>
      </div>

      <div class="duty-content">
        <div class="duty-row">
          <span class="label">Start Date:</span>
          <span class="value">{{ duty.startDate | date:'short' }}</span>
        </div>

        <div class="duty-row" *ngIf="duty.endDate">
          <span class="label">End Date:</span>
          <span class="value">{{ duty.endDate | date:'short' }}</span>
        </div>

        <div class="duty-row" *ngIf="duty.salesOrderId">
          <span class="label">Sales Order:</span>
          <span class="value">{{ duty.salesOrderNumber }} - {{ getSalesOrderCustomer(duty.salesOrderId) }}</span>
        </div>

        <div class="duty-row" *ngIf="duty.purchaseOrderId">
          <span class="label">Purchase Order:</span>
          <span class="value">{{ duty.purchaseOrderNumber }} - {{ getPurchaseOrderSupplier(duty.purchaseOrderId) }}</span>
        </div>

        <div class="duty-row" *ngIf="duty.notes">
          <span class="label">Notes:</span>
          <span class="value notes">{{ duty.notes }}</span>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="errorMessage" class="error-banner">
    {{ errorMessage }}
  </div>
</div>
